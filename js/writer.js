// writer.js - AIæ”¹å†™æ¨¡å—

// åç«¯APIåœ°å€
const API_BASE = '';

class NewsWriter {
  constructor() {
    this.currentResult = '';
    this.currentNews = null;
    this.currentStyle = 'vlog';
    this.currentFormat = 'short';
  }

  // æ”¹å†™æ–°é—»
  async rewrite(news, format = 'short', style = 'vlog') {
    this.currentNews = news;
    this.currentFormat = format;
    this.currentStyle = style;

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    this.showLoading('AIæ­£åœ¨æ”¹å†™ä¸­...');

    try {
      // è°ƒç”¨åç«¯API
      const response = await fetch(`${API_BASE}/api/rewrite`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          content: news.summary || news.title,
          format: format,
          style: style
        })
      });

      if (!response.ok) {
        throw new Error('APIè¯·æ±‚å¤±è´¥');
      }

      const result = await response.json();

      if (!result.success) {
        throw new Error(result.error || 'æ”¹å†™å¤±è´¥');
      }

      this.currentResult = result.data;
      this.hideLoading();
      return result.data;

    } catch (error) {
      console.error('æ”¹å†™å¤±è´¥:', error);
      // å¦‚æœåç«¯è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿ
      await this.delay(1000);
      const content = this.generateContent(news, format, style);
      this.currentResult = content;
      this.hideLoading();
      return content;
    }
  }

  // ç”Ÿæˆå†…å®¹
  generateContent(news, format, style) {
    const styleConfig = WRITING_STYLES[style];

    if (format === 'short') {
      return this.generateShortContent(news, style);
    } else {
      return this.generateLongContent(news, style);
    }
  }

  // ç”ŸæˆçŸ­æ–‡æ¡ˆ
  generateShortContent(news, style) {
    const templates = {
      vlog: [
        `å“‡å¡ï¼å…„å¼Ÿä»¬ï¼Œæœ€æ–°æ¶ˆæ¯æ¥äº†ï¼${news.title}ï¼Œè¿™æ³¢çœŸçš„æœ‰ç‚¹ä¸œè¥¿ï¼\n\nè®²çœŸï¼Œçœ‹å®Œè¿™ä¸ªæˆ‘æ•´ä¸ªäººéƒ½æ¿€åŠ¨äº†ã€‚${news.summary.substring(0, 60)}...\n\nå…„å¼Ÿä»¬ï¼Œä½ ä»¬è§‰å¾—è¿™è½¦æ€ä¹ˆæ ·ï¼Ÿè¯„è®ºåŒºèŠèŠï¼ğŸš—ğŸ’¨`,

        `å®¶äººä»¬ï¼é‡å¤§æ–°é—»ï¼${news.title}ï¼\n\n${news.summary.substring(0, 80)}\n\nè¯´å®è¯ï¼Œè¿™æ³¢çœŸçš„å¾ˆé¦™ï¼æˆ‘å·²ç»è¿«ä¸åŠå¾…æƒ³è¯•é©¾äº†ï¼æ„Ÿå…´è¶£çš„å…„å¼ŸèŒèµ¶ç´§å…³æ³¨èµ·æ¥ï¼å†²ï¼ğŸš€`,

        `æœ€æ–°æ¶ˆæ¯ï¼åˆšåˆšæ”¶åˆ°çš„çŒ›æ–™â€”â€”${news.title}ï¼\n\n${news.summary.substring(0, 70)}\n\nè®²é“ç†ï¼Œè¿™é…ç½®ã€è¿™ä»·æ ¼ï¼Œè¿˜è¦ä»€ä¹ˆè‡ªè¡Œè½¦ï¼Ÿæ„Ÿå…´è¶£çš„è¯„è®ºåŒºæ‰£1ï¼`
      ],
      review: [
        `ã€æ–°è½¦å¿«è®¯ã€‘${news.title}\n\n${news.summary}\n\nä»ä¸“ä¸šè§’åº¦æ¥çœ‹ï¼Œè¿™æ¬¡æ›´æ–°ç¡®å®å¾ˆæœ‰è¯šæ„ã€‚äº§å“åŠ›æå‡æ˜æ˜¾ï¼Œæ— è®ºæ˜¯é…ç½®è¿˜æ˜¯ä»·æ ¼éƒ½å¾ˆæœ‰ç«äº‰åŠ›ã€‚å»ºè®®æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹å®è½¦è¡¨ç°ã€‚`,

        `ä»Šæ—¥å…³æ³¨ï¼š${news.title}\n\nå®¢è§‚åˆ†æï¼š${news.summary}\n\næ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯ä¸€æ¬¾å€¼å¾—å…³æ³¨çš„äº§å“ã€‚å…·ä½“è¡¨ç°å¦‚ä½•ï¼Œå»ºè®®åˆ°åº—ä½“éªŒåå†åšåˆ¤æ–­ã€‚`,

        `ã€ç®€è¯„ã€‘${news.title}\n\n${news.summary}\n\näº§å“åŠ›è§£è¯»ï¼šè¿™æ¬¡æ”¹æ¬¾/ä¸Šå¸‚å¯ä»¥è¯´è¯šæ„æ»¡æ»¡ã€‚äº®ç‚¹çªå‡ºï¼ŒçŸ­æ¿ä¹Ÿæœ‰æ”¹å–„ã€‚æ¨èæŒ‡æ•°ï¼šâ­â­â­â­`
      ],
      push: [
        `ğŸ”¥é‡ç£…æ¨èï¼${news.title}ï¼\n\n${news.summary}\n\nçœŸçš„ï¼è¿™æ¬¡å¤ªç»™åŠ›äº†ï¼å®å­ä»¬ï¼Œè¿™æ³¢ç»å¯¹ä¸èƒ½é”™è¿‡ï¼\n\nç§æˆ‘äº†è§£è¯¦æƒ…ï¼Œè¿˜æœ‰é¢å¤–ç¦åˆ©ï¼å…ˆåˆ°å…ˆå¾—ï¼å†²é¸­ï¼ğŸ‰`,

        `â¤ï¸â€ğŸ”¥å¼ºçƒˆç§è‰ï¼${news.title}\n\n${news.summary}\n\næˆ‘çš„å¤©ï¼è¿™ä¸ªäº§å“ä¹Ÿå¤ªé¦™äº†å§ï¼\n\næƒ³å…¥æ‰‹çš„å®å­ä»¬ï¼ŒæŠ“ç´§æ—¶é—´ï¼åé¢æœ‰é™ï¼\n\nè¯„è®ºåŒºæ‰£"1"å®‰æ’ï¼`,

        `âœ¨å‘ç°å®è—ï¼${news.title}\n\n${news.summary}\n\nç­”åº”æˆ‘ï¼Œè¿™ä¸ªä¸€å®šè¦å…¥ï¼å¤ªé¦™äº†ï¼\n\næ„Ÿå…´è¶£çš„å®å­ä»¬èµ¶ç´§å†²ï¼é”™è¿‡ç­‰ä¸€å¹´ï¼`
      ],
      news: [
        `ã€æ±½è½¦èµ„è®¯ã€‘${news.title}\n\n${news.summary}\n\nè®°è€…äº†è§£åˆ°ï¼Œè¯¥è½¦å‹/æŠ€æœ¯çš„æ¨å‡ºå°†è¿›ä¸€æ­¥ä¸°å¯Œæ¶ˆè´¹è€…çš„é€‰æ‹©ç©ºé—´ã€‚å…·ä½“å”®ä»·åŠé…ç½®ä¿¡æ¯ï¼Œè¯·å…³æ³¨å®˜æ–¹åç»­æŠ¥é“ã€‚`,

        `æ±½è½¦åœˆåˆæœ‰æ–°åŠ¨é™ï¼${news.title}\n\n${news.summary}\n\nä¸šå†…äººå£«åˆ†æè®¤ä¸ºï¼Œ${news.source}çš„ç›¸å…³å¸ƒå±€å°†å¯¹è¡Œä¸šæ ¼å±€äº§ç”Ÿä¸€å®šå½±å“ã€‚æ›´å¤šè¯¦æƒ…ï¼Œæˆ‘ä»¬å°†æŒç»­å…³æ³¨ã€‚`,

        `ä»Šæ—¥è½¦é—»ï¼š${news.title}\n\n${news.summary}\n\næˆªè‡³å‘ç¨¿æ—¶ï¼Œå®˜æ–¹å°šæœªå…¬å¸ƒæ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚å…³æ³¨æˆ‘ä»¬ï¼Œç¬¬ä¸€æ—¶é—´è·å–æœ€æ–°èµ„è®¯ã€‚`
      ]
    };

    const options = templates[style] || templates.vlog;
    return options[Math.floor(Math.random() * options.length)];
  }

  // ç”Ÿæˆ é•¿æ–‡ç« 
  generateLongContent(news, style) {
    const templates = {
      vlog: [
        `ğŸš— ${news.title}\n\nâ€”â€”æˆ‘æ˜¯åˆ†å‰²çº¿â€”â€”\n\nå®¶äººä»¬ï¼ä»Šå¤©æ¥èŠèŠåˆšåˆšæ”¶åˆ°çš„é‡ç£…æ¶ˆæ¯ï¼${news.title}ï¼\n\nè¯´å®è¯ï¼Œå½“æˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ°è¿™ä¸ªæ–°é—»çš„æ—¶å€™ï¼Œæ•´ä¸ªäººéƒ½ç²¾ç¥äº†ï¼${news.summary}\n\nä»Šå¤©å’±ä»¬å°±å¥½å¥½èŠèŠè¿™ä¸ªäº‹å„¿ã€‚é¦–å…ˆå‘¢ï¼Œè¿™ä¸ªæ—¶é—´ç‚¹å‘å¸ƒï¼Œç¡®å®å¾ˆæœ‰æ„æ€ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œæœ€è¿‘æ±½è½¦åœˆé‚£æ˜¯ç›¸å½“çš„å·ï¼Œå„å¤§å‚å•†éƒ½åœ¨å‘åŠ›ã€‚\n\nä»ç›®å‰æ›å…‰çš„ä¿¡æ¯æ¥çœ‹ï¼Œè¿™æ¬¡çš„æ–°å“/æ–°æŠ€æœ¯ç¡®å®æœ‰ä¸å°‘äº®ç‚¹ï¼š\n\n1ï¸âƒ£ ç¬¬ä¸€ä¸ªäº®ç‚¹...ï¼ˆæ­¤å¤„çœç•¥100å­—ï¼‰\n2ï¸âƒ£ ç¬¬äºŒä¸ªäº®ç‚¹...ï¼ˆæ­¤å¤„çœç•¥100å­—ï¼‰\n3ï¸âƒ£ ç¬¬ä¸‰ä¸ªäº®ç‚¹...ï¼ˆæ­¤å¤„çœç•¥100å­—ï¼‰\n\næ€»çš„æ¥è¯´å‘¢ï¼Œè¿™æ¬¡çš„è¯šæ„è¿˜æ˜¯ç›¸å½“è¶³çš„ã€‚å½“ç„¶ï¼Œå…·ä½“è¡¨ç°æ€ä¹ˆæ ·ï¼Œè¿˜å¾—çœ‹å®è½¦ã€‚\n\nå¥½äº†ï¼Œä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œã€‚å…„å¼Ÿä»¬æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Œæ¬¢è¿è¯„è®ºåŒºèŠèŠï¼å’±ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`,

        `ğŸ¬ ${news.title}\n\nhelloå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä½ ä»¬çš„æ±½è½¦åšä¸»ï¼ä»Šå¤©å¸¦æ¥ä¸€ä¸ªè¶…çº§é‡ç£…çš„æ¶ˆæ¯ï¼\n\næ²¡é”™ï¼å°±æ˜¯${news.title}ï¼\n\n${news.summary}\n\nä½œä¸ºä¸€åä»ä¸šå¤šå¹´çš„æ±½è½¦ç¼–è¾‘ï¼Œæˆ‘çœ‹è¿‡çš„è½¦è¯´å®è¯çœŸä¸å°‘äº†ã€‚ä½†è¿™æ¬¡ï¼Œè¿˜æ˜¯æœ‰ç‚¹ä¸œè¥¿çš„ã€‚\n\nå…ˆè¯´è¯´æˆ‘çš„å‡ ç‚¹çœ‹æ³•ï¼š\n\nç¬¬ä¸€ç‚¹ï¼Œå¤–è§‚è®¾è®¡ç¡®å®å¾ˆæœ‰è¾¨è¯†åº¦ã€‚ç°åœ¨è¿™ä¸ªå¸‚åœºï¼Œæ²¡æœ‰ç‚¹ç‰¹è‰²çœŸçš„å¾ˆéš¾è„±é¢–è€Œå‡ºã€‚\n\nç¬¬äºŒç‚¹ï¼ŒåŠ¨åŠ›ç³»ç»Ÿ/é…ç½®æ°´å¹³å¾ˆæœ‰ç«äº‰åŠ›ã€‚æ€§ä»·æ¯”è¿™ä¸€å—ï¼Œç›´æ¥æ‹‰æ»¡ã€‚\n\nç¬¬ä¸‰ç‚¹ï¼Œå“ç‰Œè¿™æ¬¡çš„å®šä»·ç­–ç•¥å¾ˆæœ‰æ„æ€ã€‚çœ‹æ¥æ˜¯é“äº†å¿ƒè¦æŠ¢å å¸‚åœºä»½é¢ã€‚\n\nå½“ç„¶ï¼Œå…·ä½“è¡¨ç°å¦‚ä½•ï¼Œæˆ‘å»ºè®®å¤§å®¶è¿˜æ˜¯å»4Såº—å®åœ°ä½“éªŒä¸€ä¸‹ã€‚æ¯•ç«Ÿç½‘ä¸Šè¯´çš„å†é¦™ï¼Œä¸å¦‚è‡ªå·±åä¸Šå»æ„Ÿå—ä¸€ä¸‹ã€‚\n\nokï¼Œä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œã€‚å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè®°å¾—ä¸€é”®ä¸‰è¿ï¼æˆ‘æ˜¯ä½ ä»¬çš„è€æœ‹å‹ï¼Œä¸‹æœŸå†ä¼šï¼`
      ],
      review: [
        `ã€æ·±åº¦è§£æã€‘${news.title}\n\nä¸€ã€äº‹ä»¶èƒŒæ™¯\n\nä»Šæ—¥ï¼Œæ±½è½¦è¡Œä¸šè¿æ¥é‡è¦æ¶ˆæ¯ï¼š${news.title}ã€‚${news.summary}\n\näºŒã€äº§å“/æŠ€æœ¯åˆ†æ\n\n1. åŠ¨åŠ›ç³»ç»Ÿ\næœ¬æ¬¡æ›´æ–°åœ¨åŠ¨åŠ›æ–¹é¢çš„æå‡è¾ƒä¸ºæ˜æ˜¾ã€‚é‡‡ç”¨äº†æœ€æ–°çš„æŠ€æœ¯è·¯çº¿ï¼Œåœ¨ä¿è¯åŠ¨åŠ›è¾“å‡ºçš„åŒæ—¶ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†ç‡ƒæ²¹ç»æµæ€§/ç»­èˆªè¡¨ç°ã€‚\n\n2. æ™ºèƒ½é…ç½®\næ™ºèƒ½åŒ–æ˜¯å½“ä¸‹æ±½è½¦å‘å±•çš„é‡è¦æ–¹å‘ã€‚æœ¬æ¬¡æ›´æ–°åœ¨æ™ºèƒ½åº§èˆ±ã€æ™ºèƒ½é©¾é©¶æ–¹é¢éƒ½æœ‰æ‰€å‡çº§ã€‚å…·ä½“è¡¨ç°åœ¨ï¼š\n- èŠ¯ç‰‡ç®—åŠ›æå‡\n- ä¼ æ„Ÿå™¨æ•°é‡å¢åŠ \n- è½¯ä»¶ç®—æ³•ä¼˜åŒ–\n\n3. ç©ºé—´èˆ’é€‚æ€§\nä½œä¸ºå®¶ç”¨è½¦ï¼Œç©ºé—´è¡¨ç°è‡³å…³é‡è¦ã€‚æ–°è½¦åœ¨è½´è·/è½¦èº«å°ºå¯¸ä¸Šæœ‰æ‰€æå‡ï¼Œå®é™…ä¹˜åä½“éªŒéœ€è¦å®è½¦éªŒè¯ã€‚\n\nä¸‰ã€å¸‚åœºå½±å“åˆ†æ\n\nä»å¸‚åœºè§’åº¦æ¥çœ‹ï¼Œ${news.title}çš„æ¨å‡ºï¼Œå°†å¯¹åŒçº§åˆ«ç«å“å½¢æˆä¸€å®šå‹åŠ›ã€‚å°¤å…¶æ˜¯åœ¨${news.source}ç»†åˆ†å¸‚åœºï¼Œå¯èƒ½å¼•å‘æ–°ä¸€è½®ç«äº‰ã€‚\n\nå››ã€è´­ä¹°å»ºè®®\n\nå¯¹äºè¿‘æœŸæœ‰è´­è½¦è®¡åˆ’çš„æœ‹å‹ï¼Œå»ºè®®ï¼š\n1. ä¿æŒå…³æ³¨ï¼Œç­‰å¾…è¯¦ç»†è¯„æµ‹\n2. è¯•é©¾ä½“éªŒï¼Œæ„Ÿå—å®é™…è¡¨ç°\n3. å¯¹æ¯”ç«å“ï¼Œç»¼åˆè€ƒè™‘æ€§ä»·æ¯”\n\næœ¬æ–‡å°†æŒç»­å…³æ³¨è¯¥è½¦å‹çš„åç»­æŠ¥é“ã€‚`,

        `ã€æ±½è½¦è§‚å¯Ÿã€‘${news.title}\n\nè¡Œä¸šåŠ¨æ€\n\nä»Šæ—¥ï¼Œ${news.source}æ­£å¼å‘å¸ƒäº†${news.title}çš„ç›¸å…³ä¿¡æ¯ã€‚${news.summary}\n\næ·±åº¦è§£è¯»\n\nä»è¡Œä¸šè§’åº¦åˆ†æï¼Œæ­¤æ¬¡å‘å¸ƒæœ‰ä»¥ä¸‹å‡ ä¸ªçœ‹ç‚¹ï¼š\n\né¦–å…ˆæ˜¯æŠ€æœ¯å±‚é¢ã€‚æ–°å“åœ¨æ ¸å¿ƒæŠ€æœ¯ä¸Šæœ‰æ‰€çªç ´ï¼Œä½“ç°äº†å“ç‰Œçš„ç ”å‘å®åŠ›ã€‚æ— è®ºæ˜¯åŠ¨åŠ›ç”µæ± ã€ç”µæœºç”µæ§ï¼Œè¿˜æ˜¯æ™ºèƒ½é©¾é©¶ï¼Œéƒ½è¾¾åˆ°äº†åŒçº§åˆ«ä¸»æµæ°´å¹³ã€‚\n\nå…¶æ¬¡æ˜¯å¸‚åœºå®šä½ã€‚äº§å“çš„å®šä»·ç­–ç•¥å’Œé…ç½®ç»„åˆï¼Œæ˜æ˜¾æ˜¯å¥”ç€èµ°é‡å»çš„ã€‚è¿™ä¹Ÿå°†å¯¹åŒçº§åˆ«å…¶ä»–å“ç‰Œå½¢æˆç›´æ¥ç«äº‰ã€‚\n\nç¬¬ä¸‰æ˜¯æ¸ é“å¸ƒå±€ã€‚ä»å‘å¸ƒèŠ‚å¥æ¥çœ‹ï¼Œå“ç‰Œå·²ç»åšå¥½äº†å……åˆ†çš„å¸‚åœºå‡†å¤‡ã€‚\n\nç«å“å¯¹æ¯”\n\nä»ç›®å‰æŒæ¡çš„ä¿¡æ¯æ¥çœ‹ï¼Œæ–°è½¦çš„ç›´æ¥ç«å“ä¸»è¦åŒ…æ‹¬ï¼š\n- ç«å“Aï¼šä¼˜åŠ¿åœ¨äºå“ç‰Œè®¤çŸ¥åº¦\n- ç«å“Bï¼šä¼˜åŠ¿åœ¨äºæ€§ä»·æ¯”\n- ç«å“Cï¼šä¼˜åŠ¿åœ¨äºæŠ€æœ¯é¢†å…ˆ\n\nç»¼åˆæ¥çœ‹ï¼Œè¿™æ¬¾äº§å“æœ‰å…¶ç‹¬ç‰¹çš„ç«äº‰åŠ›ã€‚æ˜¯å¦å€¼å¾—è´­ä¹°ï¼Œå»ºè®®ç­‰è¯¦ç»†è¯„æµ‹å‡ºæ¥åå†åšåˆ¤æ–­ã€‚\n\nç»“è¯­\n\næ±½è½¦å¸‚åœºçš„ç«äº‰æ—¥è¶‹æ¿€çƒˆï¼Œæ¶ˆè´¹è€…çš„é€‰æ‹©ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚å¯¹äºæ™®é€šæ¶ˆè´¹è€…æ¥è¯´ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ã€‚å»ºè®®å¤§å®¶åœ¨é€‰è½¦æ—¶ï¼Œå……åˆ†è€ƒè™‘è‡ªèº«éœ€æ±‚ï¼Œå¤šå¯¹æ¯”ã€å¤šè¯•é©¾ã€‚`
      ],
      push: [
        `â¤ï¸ å¼ºçƒˆæ¨èï¼${news.title}\n\nå®¶äººä»¬ï¼ä»Šå¤©å¿…é¡»ç»™å¤§å®¶å®‰åˆ©ä¸€æ³¢ï¼\n\nä½ ä»¬è¦çš„çœŸçš„æ¥äº†ï¼${news.title}ï¼\n\nè®²çœŸï¼Œå½“æˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼Œæˆ‘å°±çŸ¥é“â€”â€”è¿™æ³¢ç¨³äº†ï¼\n\nå…ˆè¯´è¯´è¿™ä¸ª${news.summary}\n\nç›¸ä¿¡æˆ‘ï¼Œè¿™ç»å¯¹æ˜¯ä¸€æ¬¾å€¼å¾—å…³æ³¨çš„äº§å“ï¼ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ\n\nâœ… äº®ç‚¹ä¸€ï¼šé¢œå€¼èƒ½æ‰“\nâœ… äº®ç‚¹äºŒï¼šé…ç½®ä¸°å¯Œ\nâœ… äº®ç‚¹ä¸‰ï¼šä»·æ ¼ç¾ä¸½\n\nè€Œä¸”æœ€é‡è¦çš„æ˜¯ï¼Œç°åœ¨å…¥æ‰‹çœŸçš„æ˜¯æœ€ä½³æ—¶æœºï¼\n\næˆ‘å·²ç»å¸®ä½ ä»¬è¯•è¿‡äº†ï¼Œç¡®å®é¦™ï¼æƒ³äº†è§£çš„å®å­ä»¬ï¼Œè¯„è®ºåŒºæ‰£"1"ï¼Œæˆ‘æ¥å®‰æ’ï¼\n\næ•°é‡æœ‰é™ï¼Œå…ˆåˆ°å…ˆå¾—ï¼å†²é¸­ï¼ğŸ‰\n\n#æ±½è½¦ #æ–°è½¦ #ç§è‰`,

        `âœ¨çˆ†æ¬¾é¢„è­¦ï¼${news.title}\n\nå§å¦¹ä»¬ï¼å…„å¼Ÿä»¬ï¼ä»Šå¤©å¿…é¡»åˆ†äº«ä¸€ä¸ªè¶…çº§é‡ç£…çš„æ¶ˆæ¯ï¼\n\n${news.title}æ¥äº†ï¼\n\nçœŸçš„ï¼çœ‹å®Œè¿™ä¸ªæˆ‘æ•´ä¸ªäººéƒ½æ¿€åŠ¨äº†ï¼${news.summary}\n\nè¯´çœŸçš„ï¼Œè¿™ç»å¯¹æ˜¯æˆ‘ä»Šå¹´è§è¿‡æœ€é¦™çš„äº§å“ä¹‹ä¸€ï¼\n\nä½ ä»¬çœ‹çœ‹è¿™é…ç½®ï¼š\nğŸ‘ å¤–è§‚ï¼šé¢œå€¼å³æ­£ä¹‰\nğŸ‘ æ€§èƒ½ï¼šåŠ¨åŠ›å……æ²›\nğŸ‘ æ€§ä»·æ¯”ï¼šåŒçº§æœ€é¦™\n\nè€Œä¸”ç°åœ¨æ­£å€¼æ´»åŠ¨æœŸé—´ï¼Œç¦åˆ©å¤šå¤šï¼\n\næˆ‘å·²ç»å¸®ä½ ä»¬é—®è¿‡äº†ï¼Œç°åœ¨å…¥æ‰‹ç»å¯¹ä¸äºï¼\n\næ„Ÿå…´è¶£çš„å®å­ä»¬ï¼Œéº»æºœçš„ï¼åé¢æœ‰é™ï¼Œæ‰‹æ…¢æ— ï¼\n\nè¯„è®ºåŒºæ‰£"1"ï¼Œæˆ‘æ¥ç»™ä½ å®‰æ’ï¼ğŸš€`
      ],
      news: [
        `ã€æ±½è½¦ä¹‹å®¶ã€‘${news.title}\n\n[æ–°é—»èƒŒæ™¯]\n\nä»Šæ—¥ï¼Œ${news.source}æ­£å¼å¯¹å¤–å‘å¸ƒäº†${news.title}çš„ç›¸å…³ä¿¡æ¯ã€‚${news.summary}\n\n[è¯¦ç»†æŠ¥é“]\n\næ®å®˜æ–¹ä»‹ç»ï¼Œæœ¬æ¬¡å‘å¸ƒçš„è½¦å‹/æŠ€æœ¯å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\nä¸€ã€äº§å“äº®ç‚¹\n1. é‡‡ç”¨æœ€æ–°çš„è®¾è®¡è¯­è¨€ï¼Œå¤–è§‚æ›´å…·è¾¨è¯†åº¦\n2. åŠ¨åŠ›ç³»ç»Ÿå…¨é¢å‡çº§ï¼Œæ€§èƒ½è¡¨ç°æ›´å‡ºè‰²\n3. æ™ºèƒ½é…ç½®ä¸°å¯Œï¼Œæ™ºèƒ½åŒ–ç¨‹åº¦æ›´é«˜\n\näºŒã€å¸‚åœºå®šä½\nè¯¥è½¦å‹ä¸»è¦é¢å‘è¿½æ±‚å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹ç¾¤ä½“ï¼Œå®šä»·ç­–ç•¥å…¼é¡¾æ€§ä»·æ¯”ã€‚\n\nä¸‰ã€æœªæ¥è§„åˆ’\n\nå®˜æ–¹è¡¨ç¤ºï¼Œå°†æŒç»­æ·±è€•ä¸­å›½å¸‚åœºï¼Œä¸ºæ¶ˆè´¹è€…å¸¦æ¥æ›´å¤šä¼˜è´¨äº§å“ã€‚\n\n[è®°è€…è§‚å¯Ÿ]\n\nä½œä¸ºæ±½è½¦è¡Œä¸šçš„é‡è¦äº‹ä»¶ï¼Œ${news.title}çš„å‘å¸ƒå¼•èµ·äº†ä¸šå†…å¹¿æ³›å…³æ³¨ã€‚æœ‰åˆ†æè®¤ä¸ºï¼Œè¿™å°†æ¨åŠ¨${news.source}ç»†åˆ†å¸‚åœºçš„ç«äº‰æ ¼å±€å‘ç”Ÿå˜åŒ–ã€‚\n\n[åç»­æŠ¥é“]\n\næˆ‘ä»¬å°†æŒç»­å…³æ³¨è¯¥è½¦å‹çš„æœ€æ–°è¿›å±•ï¼Œå¹¶ä¸ºæ‚¨å¸¦æ¥æ›´å¤šè¯¦ç»†æŠ¥é“ã€‚`,

        `ã€è¡Œä¸šå¿«è®¯ã€‘${news.title}\n\nä»Šæ—¥ï¼Œ${news.source}æ­£å¼å®£å¸ƒï¼š${news.title}ã€‚è¿™æ˜¯${news.source}ä»Šå¹´åœ¨æ±½è½¦å¸‚åœºçš„åˆä¸€é‡è¦å¸ƒå±€ã€‚\n\n${news.summary}\n\n[æ·±åº¦åˆ†æ]\n\n1. å¸‚åœºå½±å“\nè¯¥äº§å“çš„æ¨å‡ºï¼Œå°†è¿›ä¸€æ­¥å®Œå–„${news.source}çš„äº§å“çŸ©é˜µï¼Œå¢å¼ºåœ¨${news.source}ç»†åˆ†å¸‚åœºçš„ç«äº‰åŠ›ã€‚\n\n2. æŠ€æœ¯äº®ç‚¹\næ–°äº§å“åœ¨åŠ¨åŠ›ã€æ™ºèƒ½åŒ–ã€ç©ºé—´ç­‰æ–¹é¢éƒ½æœ‰æ˜æ˜¾å‡çº§ï¼Œä½“ç°äº†å“ç‰Œçš„æŠ€æœ¯å®åŠ›ã€‚\n\n3. ç«äº‰æ ¼å±€\néšç€æ–°å“çš„åŠ å…¥ï¼Œ${news.source}ç»†åˆ†å¸‚åœºçš„ç«äº‰å°†æ›´åŠ æ¿€çƒˆã€‚\n\n[ç»“è¯­]\n\næ€»çš„æ¥çœ‹ï¼Œ${news.title}æ˜¯ä¸€æ¬¾å€¼å¾—å…³æ³¨çš„äº§å“ã€‚å…·ä½“å¸‚åœºè¡¨ç°å¦‚ä½•ï¼Œè¿˜éœ€ç­‰å¾…æ—¶é—´æ£€éªŒã€‚\n\næ±½è½¦ä¹‹å®¶å°†æŒç»­å…³æ³¨æŠ¥é“ã€‚`
      ]
    };

    const options = templates[style] || templates.vlog;
    return options[Math.floor(Math.random() * options.length)];
  }

  // é‡æ–°ç”Ÿæˆ
  async regenerate() {
    if (!this.currentNews) {
      throw new Error('æ²¡æœ‰å¯é‡æ–°ç”Ÿæˆçš„å†…å®¹');
    }
    return this.rewrite(this.currentNews, this.currentFormat, this.currentStyle);
  }

  // å»¶è¿Ÿå‡½æ•°
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // æ˜¾ç¤ºåŠ è½½
  showLoading(text) {
    const overlay = document.getElementById('loadingOverlay');
    const textEl = document.getElementById('loadingText');
    if (overlay && textEl) {
      textEl.textContent = text;
      overlay.classList.remove('hidden');
    }
  }

  // éšè—åŠ è½½
  hideLoading() {
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
      overlay.classList.add('hidden');
    }
  }

  // è·å–å½“å‰ç»“æœ
  getCurrentResult() {
    return this.currentResult;
  }
}

// åˆ›å»ºå…¨å±€å®ä¾‹
const newsWriter = new NewsWriter();
